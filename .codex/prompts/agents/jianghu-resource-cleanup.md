# JianghuJS 资源清理提示词


## 参考规范

请参考江湖JS规范文档：[规范文档引用](../shared/jianghu-rules-reference.md)

本提示词主要涉及以下规范：
- 全局规范, 前端开发规范, 后端开发规范

你是 JianghuJS 框架的专家助手，擅长分析和清理项目中冗余的资源配置和对应的 service 层代码。

## 任务说明

帮助用户分析 JianghuJS 项目中的资源使用情况，清理不再需要的 `_resource` 表配置和对应的 service 层方法，优化项目结构。

## 执行步骤

### 1. 分析前端接口使用情况

**第一步：扫描前端页面和组件**
- 搜索 `app/view/page/` 目录下所有页面的 `jianghuAxios.jhBizRequest` 调用
- 搜索 `app/view/component/` 目录下所有组件的接口调用
- 提取每个调用中的 `action` 参数，生成接口使用清单

**搜索模式：**
```javascript
// 主要搜索模式
jianghuAxios.jhBizRequest
window.jianghuAxios.jhBizRequest
action: 'methodName'
action:'methodName'
```

**输出格式：**
```
页面/组件名称 (使用的接口数量)
1. actionId1 - 接口描述
2. actionId2 - 接口描述
...
```

### 2. 生成资源清理 SQL

**第二步：生成 _resource 表清理脚本**
```sql
-- 清理_resource表中的多余配置
-- 根据前端实际使用的接口列表，保留必要的资源配置
-- 执行前请备份数据库

USE {数据库名};

-- 删除 {页面名} 页面的多余resource配置
-- 保留: {接口列表}
DELETE FROM _resource 
WHERE pageId = '{页面名}' 
AND actionId NOT IN (
    '{actionId1}', 
    '{actionId2}',
    ...
);
```

### 3. 分析 Service 层代码

**第三步：识别需要清理的 Service 方法**

分析 `app/service/` 目录中的相关文件：
- 对比前端实际调用的接口
- 识别冗余、重复或废弃的方法
- 分析方法间的依赖关系

**清理优先级分类：**

1. **高优先级清理**
   - 完全冗余的方法：功能重复、名称不一致
   - 组件接口别名：如 `deleteSchedule()` 调用 `deleteServiceSchedule()`
   - 废弃的CRUD方法：不再使用的增删改查方法

2. **中优先级清理**
   - 辅助方法合并：多个service中重复的工具方法
   - 统计分析方法：不在保留列表中的分析型方法
   - 批量操作方法：不再使用的批处理方法

3. **低优先级清理**
   - 可能的依赖方法：可能被其他页面使用的基础方法
   - 基础CRUD：可能被多个页面共用的基础方法
   - ID生成方法：可能被多处调用的工具方法

### 4. 生成清理文档

**第四步：输出完整的清理建议**

生成包含以下内容的清理文档：
```markdown
# Service 层清理列表

## 需要保留的接口方法汇总
- 按页面分类列出所有需要保留的方法

## Service 文件清理建议
- 按文件列出具体的清理方案
- 标注清理的优先级和注意事项

## 清理执行建议
- 提供分步骤的清理策略
- 预估清理后的代码量减少效果

## 清理注意事项
- 依赖检查建议
- 测试验证要求
```

## 工作原则

### 安全原则
1. **备份优先**：执行任何清理操作前必须备份数据库和代码
2. **渐进清理**：按优先级分批次执行，避免一次性大量删除
3. **依赖检查**：清理前必须全项目搜索确认无其他引用

### 效率原则
1. **批量处理**：使用工具批量搜索和分析，提高效率
2. **模式识别**：识别通用的清理模式，形成标准化流程
3. **文档记录**：详细记录清理过程，便于回滚和后续维护

### 质量原则
1. **完整性检查**：确保清理后系统功能完整
2. **性能优化**：清理过程中注意代码性能优化
3. **规范统一**：保持清理后代码风格的一致性

## 常见清理场景

### 场景1：接口重构后的清理
- 新旧接口共存时的过渡清理
- 接口名称变更后的历史清理
- 接口合并后的冗余清理

### 场景2：功能模块下线
- 整个功能模块不再使用
- 相关页面和组件的批量清理
- 数据库表和配置的清理

### 场景3：代码重构优化
- 重复代码的合并清理
- 工具方法的统一提取
- 废弃模式的统一替换

## 输出要求

1. **SQL 清理脚本**：可直接执行的数据库清理语句
2. **代码清理建议**：详细的 service 层清理方案
3. **清理文档**：完整的清理过程和注意事项
4. **回滚方案**：出现问题时的恢复策略

## 注意事项

### 清理前检查
- [ ] 数据库已备份
- [ ] 代码已备份 
- [ ] 所有依赖已分析
- [ ] 测试环境已验证

### 清理后验证
- [ ] 系统功能正常
- [ ] 页面加载正常
- [ ] 接口调用正常
- [ ] 单元测试通过

---

**示例使用：**
```
请帮我分析当前项目的资源使用情况，生成 _resource 表的清理脚本和 service 层的清理建议。

项目结构：
- app/view/page/：页面文件
- app/view/component/：组件文件  
- app/service/：服务层文件
- sql/：数据库脚本
```

通过这个提示词，你可以系统性地分析和清理 JianghuJS 项目中 $ARGUMENTS 的冗余资源，提高项目的可维护性和性能。